import{S as ur,Z as d,b as z,u as R,o as g,r as Ye,s as f,l as w,c as Ha,i as Ae,d as Ne,f as G,g as Qa,n as ce,h as en,j as A}from"./types.js";import"./index.js";var lr="vercel.ai.error",tn=Symbol.for(lr),cr,rn=class pr extends Error{constructor({name:t,message:r,cause:a}){super(r),this[cr]=!0,this.name=t,this.cause=a}static isInstance(t){return pr.hasMarker(t,lr)}static hasMarker(t,r){const a=Symbol.for(r);return t!=null&&typeof t=="object"&&a in t&&typeof t[a]=="boolean"&&t[a]===!0}};cr=tn;var h=rn,dr="AI_APICallError",fr=`vercel.ai.error.${dr}`,an=Symbol.for(fr),mr,nn=class extends h{constructor({message:e,url:t,requestBodyValues:r,statusCode:a,responseHeaders:n,responseBody:o,cause:s,isRetryable:u=a!=null&&(a===408||a===409||a===429||a>=500),data:i}){super({name:dr,message:e,cause:s}),this[mr]=!0,this.url=t,this.requestBodyValues=r,this.statusCode=a,this.responseHeaders=n,this.responseBody=o,this.isRetryable=u,this.data=i}static isInstance(e){return h.hasMarker(e,fr)}};mr=an;function be(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}var gr="AI_InvalidArgumentError",hr=`vercel.ai.error.${gr}`,on=Symbol.for(hr),yr,sn=class extends h{constructor({message:t,cause:r,argument:a}){super({name:gr,message:t,cause:r}),this[yr]=!0,this.argument=a}static isInstance(t){return h.hasMarker(t,hr)}};yr=on;var vr="AI_InvalidPromptError",_r=`vercel.ai.error.${vr}`,un=Symbol.for(_r),br,J=class extends h{constructor({prompt:e,message:t,cause:r}){super({name:vr,message:`Invalid prompt: ${t}`,cause:r}),this[br]=!0,this.prompt=e}static isInstance(e){return h.hasMarker(e,_r)}};br=un;var Sr="AI_JSONParseError",Tr=`vercel.ai.error.${Sr}`,ln=Symbol.for(Tr),wr,Jt=class extends h{constructor({text:t,cause:r}){super({name:Sr,message:`JSON parsing failed: Text: ${t}.
Error message: ${be(r)}`,cause:r}),this[wr]=!0,this.text=t}static isInstance(t){return h.hasMarker(t,Tr)}};wr=ln;var xr="AI_TypeValidationError",Ar=`vercel.ai.error.${xr}`,cn=Symbol.for(Ar),Ir,pn=class Xe extends h{constructor({value:t,cause:r}){super({name:xr,message:`Type validation failed: Value: ${JSON.stringify(t)}.
Error message: ${be(r)}`,cause:r}),this[Ir]=!0,this.value=t}static isInstance(t){return h.hasMarker(t,Ar)}static wrap({value:t,cause:r}){return Xe.isInstance(r)&&r.value===t?r:new Xe({value:t,cause:r})}};Ir=cn;var zt=pn;let Er=(e,t=21)=>(r=t)=>{let a="",n=r|0;for(;n--;)a+=e[Math.random()*e.length|0];return a};function dn(e){return new ReadableStream({async pull(t){try{const{value:r,done:a}=await e.next();a?t.close():t.enqueue(r)}catch(r){t.error(r)}},cancel(){}})}async function fn(e){return e==null?Promise.resolve():new Promise(t=>setTimeout(t,e))}var W=({prefix:e,size:t=16,alphabet:r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:a="-"}={})=>{const n=Er(r,t);if(e==null)return n;if(r.includes(a))throw new sn({argument:"separator",message:`The separator "${a}" must not be part of the alphabet "${r}".`});return o=>`${e}${a}${n(o)}`};W();function mn(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}function gn(e){return e instanceof Error&&(e.name==="AbortError"||e.name==="TimeoutError")}var He=Symbol.for("vercel.ai.validator");function hn(e){return{[He]:!0,validate:e}}function yn(e){return typeof e=="object"&&e!==null&&He in e&&e[He]===!0&&"validate"in e}function vn(e){return yn(e)?e:_n(e)}function _n(e){return hn(t=>{const r=e.safeParse(t);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}})}function Oe({value:e,schema:t}){const r=vn(t);try{if(r.validate==null)return{success:!0,value:e};const a=r.validate(e);return a.success?a:{success:!1,error:zt.wrap({value:e,cause:a.error})}}catch(a){return{success:!1,error:zt.wrap({value:e,cause:a})}}}function Rr({text:e,schema:t}){try{const r=ur.parse(e);if(t==null)return{success:!0,value:r,rawValue:r};const a=Oe({value:r,schema:t});return a.success?{...a,rawValue:r}:a}catch(r){return{success:!1,error:Jt.isInstance(r)?r:new Jt({text:e,cause:r})}}}var{btoa:bn,atob:Sn}=globalThis;function it(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),r=Sn(t);return Uint8Array.from(r,a=>a.codePointAt(0))}function Qe(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCodePoint(e[r]);return bn(t)}var kr="vercel.ai.error",Tn=Symbol.for(kr),Pr,wn=class Nr extends Error{constructor({name:t,message:r,cause:a}){super(r),this[Pr]=!0,this.name=t,this.cause=a}static isInstance(t){return Nr.hasMarker(t,kr)}static hasMarker(t,r){const a=Symbol.for(r);return t!=null&&typeof t=="object"&&a in t&&typeof t[a]=="boolean"&&t[a]===!0}};Pr=Tn;var ne=wn;function Or(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}var Mr="AI_InvalidArgumentError",Cr=`vercel.ai.error.${Mr}`,xn=Symbol.for(Cr),$r,An=class extends ne{constructor({message:t,cause:r,argument:a}){super({name:Mr,message:t,cause:r}),this[$r]=!0,this.argument=a}static isInstance(t){return ne.hasMarker(t,Cr)}};$r=xn;var Dr="AI_JSONParseError",jr=`vercel.ai.error.${Dr}`,In=Symbol.for(jr),Ur,qt=class extends ne{constructor({text:e,cause:t}){super({name:Dr,message:`JSON parsing failed: Text: ${e}.
Error message: ${Or(t)}`,cause:t}),this[Ur]=!0,this.text=e}static isInstance(e){return ne.hasMarker(e,jr)}};Ur=In;var Fr="AI_TypeValidationError",Lr=`vercel.ai.error.${Fr}`,En=Symbol.for(Lr),Zr,Rn=class et extends ne{constructor({value:t,cause:r}){super({name:Fr,message:`Type validation failed: Value: ${JSON.stringify(t)}.
Error message: ${Or(r)}`,cause:r}),this[Zr]=!0,this.value=t}static isInstance(t){return ne.hasMarker(t,Lr)}static wrap({value:t,cause:r}){return et.isInstance(r)&&r.value===t?r:new et({value:t,cause:r})}};Zr=En;var Gt=Rn,kn=({prefix:e,size:t=16,alphabet:r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:a="-"}={})=>{const n=Er(r,t);if(e==null)return n;if(r.includes(a))throw new An({argument:"separator",message:`The separator "${a}" must not be part of the alphabet "${r}".`});return o=>`${e}${a}${n(o)}`};kn();var Ie=Symbol.for("vercel.ai.validator");function Pn(e){return{[Ie]:!0,validate:e}}function Nn(e){return typeof e=="object"&&e!==null&&Ie in e&&e[Ie]===!0&&"validate"in e}function On(e){return Nn(e)?e:Mn(e)}function Mn(e){return Pn(t=>{const r=e.safeParse(t);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}})}function Cn({value:e,schema:t}){const r=On(t);try{if(r.validate==null)return{success:!0,value:e};const a=r.validate(e);return a.success?a:{success:!1,error:Gt.wrap({value:e,cause:a.error})}}catch(a){return{success:!1,error:Gt.wrap({value:e,cause:a})}}}function Kt({text:e,schema:t}){try{const r=ur.parse(e);if(t==null)return{success:!0,value:r,rawValue:r};const a=Cn({value:r,schema:t});return a.success?{...a,rawValue:r}:a}catch(r){return{success:!1,error:qt.isInstance(r)?r:new qt({text:e,cause:r})}}}const $n=Symbol("Let zodToJsonSchema decide on which parser to use"),Wt={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},Dn=e=>typeof e=="string"?{...Wt,name:e}:{...Wt,...e},jn=e=>{const t=Dn(e),r=t.name!==void 0?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,flags:{hasReferencedOpenAiAnyType:!1},currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([a,n])=>[n._def,{def:n._def,path:[...t.basePath,t.definitionPath,a],jsonSchema:void 0}]))}};function Vr(e,t,r,a){a?.errorMessages&&r&&(e.errorMessage={...e.errorMessage,[t]:r})}function v(e,t,r,a,n){e[t]=r,Vr(e,t,a,n)}const Br=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")};function P(e){if(e.target!=="openAi")return{};const t=[...e.basePath,e.definitionPath,e.openAiAnyTypeName];return e.flags.hasReferencedOpenAiAnyType=!0,{$ref:e.$refStrategy==="relative"?Br(t,e.currentPath):t.join("/")}}function Un(e,t){const r={type:"array"};return e.type?._def&&e.type?._def?.typeName!==d.ZodAny&&(r.items=y(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&v(r,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&v(r,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(v(r,"minItems",e.exactLength.value,e.exactLength.message,t),v(r,"maxItems",e.exactLength.value,e.exactLength.message,t)),r}function Fn(e,t){const r={type:"integer",format:"int64"};if(!e.checks)return r;for(const a of e.checks)switch(a.kind){case"min":t.target==="jsonSchema7"?a.inclusive?v(r,"minimum",a.value,a.message,t):v(r,"exclusiveMinimum",a.value,a.message,t):(a.inclusive||(r.exclusiveMinimum=!0),v(r,"minimum",a.value,a.message,t));break;case"max":t.target==="jsonSchema7"?a.inclusive?v(r,"maximum",a.value,a.message,t):v(r,"exclusiveMaximum",a.value,a.message,t):(a.inclusive||(r.exclusiveMaximum=!0),v(r,"maximum",a.value,a.message,t));break;case"multipleOf":v(r,"multipleOf",a.value,a.message,t);break}return r}function Ln(){return{type:"boolean"}}function Jr(e,t){return y(e.type._def,t)}const Zn=(e,t)=>y(e.innerType._def,t);function zr(e,t,r){const a=r??t.dateStrategy;if(Array.isArray(a))return{anyOf:a.map((n,o)=>zr(e,t,n))};switch(a){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return Vn(e,t)}}const Vn=(e,t)=>{const r={type:"integer",format:"unix-time"};if(t.target==="openApi3")return r;for(const a of e.checks)switch(a.kind){case"min":v(r,"minimum",a.value,a.message,t);break;case"max":v(r,"maximum",a.value,a.message,t);break}return r};function Bn(e,t){return{...y(e.innerType._def,t),default:e.defaultValue()}}function Jn(e,t){return t.effectStrategy==="input"?y(e.schema._def,t):P(t)}function zn(e){return{type:"string",enum:Array.from(e.values)}}const qn=e=>"type"in e&&e.type==="string"?!1:"allOf"in e;function Gn(e,t){const r=[y(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),y(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(o=>!!o);let a=t.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const n=[];return r.forEach(o=>{if(qn(o))n.push(...o.allOf),o.unevaluatedProperties===void 0&&(a=void 0);else{let s=o;if("additionalProperties"in o&&o.additionalProperties===!1){const{additionalProperties:u,...i}=o;s=i}else a=void 0;n.push(s)}}),n.length?{allOf:n,...a}:void 0}function Kn(e,t){const r=typeof e.value;return r!=="bigint"&&r!=="number"&&r!=="boolean"&&r!=="string"?{type:Array.isArray(e.value)?"array":"object"}:t.target==="openApi3"?{type:r==="bigint"?"integer":r,enum:[e.value]}:{type:r==="bigint"?"integer":r,const:e.value}}let Ve;const D={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Ve===void 0&&(Ve=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Ve),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function qr(e,t){const r={type:"string"};if(e.checks)for(const a of e.checks)switch(a.kind){case"min":v(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,a.value):a.value,a.message,t);break;case"max":v(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,a.value):a.value,a.message,t);break;case"email":switch(t.emailStrategy){case"format:email":j(r,"email",a.message,t);break;case"format:idn-email":j(r,"idn-email",a.message,t);break;case"pattern:zod":k(r,D.email,a.message,t);break}break;case"url":j(r,"uri",a.message,t);break;case"uuid":j(r,"uuid",a.message,t);break;case"regex":k(r,a.regex,a.message,t);break;case"cuid":k(r,D.cuid,a.message,t);break;case"cuid2":k(r,D.cuid2,a.message,t);break;case"startsWith":k(r,RegExp(`^${Be(a.value,t)}`),a.message,t);break;case"endsWith":k(r,RegExp(`${Be(a.value,t)}$`),a.message,t);break;case"datetime":j(r,"date-time",a.message,t);break;case"date":j(r,"date",a.message,t);break;case"time":j(r,"time",a.message,t);break;case"duration":j(r,"duration",a.message,t);break;case"length":v(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,a.value):a.value,a.message,t),v(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,a.value):a.value,a.message,t);break;case"includes":{k(r,RegExp(Be(a.value,t)),a.message,t);break}case"ip":{a.version!=="v6"&&j(r,"ipv4",a.message,t),a.version!=="v4"&&j(r,"ipv6",a.message,t);break}case"base64url":k(r,D.base64url,a.message,t);break;case"jwt":k(r,D.jwt,a.message,t);break;case"cidr":{a.version!=="v6"&&k(r,D.ipv4Cidr,a.message,t),a.version!=="v4"&&k(r,D.ipv6Cidr,a.message,t);break}case"emoji":k(r,D.emoji(),a.message,t);break;case"ulid":{k(r,D.ulid,a.message,t);break}case"base64":{switch(t.base64Strategy){case"format:binary":{j(r,"binary",a.message,t);break}case"contentEncoding:base64":{v(r,"contentEncoding","base64",a.message,t);break}case"pattern:zod":{k(r,D.base64,a.message,t);break}}break}case"nanoid":k(r,D.nanoid,a.message,t)}return r}function Be(e,t){return t.patternStrategy==="escape"?Yn(e):e}const Wn=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function Yn(e){let t="";for(let r=0;r<e.length;r++)Wn.has(e[r])||(t+="\\"),t+=e[r];return t}function j(e,t,r,a){e.format||e.anyOf?.some(n=>n.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&a.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.anyOf.push({format:t,...r&&a.errorMessages&&{errorMessage:{format:r}}})):v(e,"format",t,r,a)}function k(e,t,r,a){e.pattern||e.allOf?.some(n=>n.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&a.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.allOf.push({pattern:Yt(t,a),...r&&a.errorMessages&&{errorMessage:{pattern:r}}})):v(e,"pattern",Yt(t,a),r,a)}function Yt(e,t){if(!t.applyRegexFlags||!e.flags)return e.source;const r={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},a=r.i?e.source.toLowerCase():e.source;let n="",o=!1,s=!1,u=!1;for(let i=0;i<a.length;i++){if(o){n+=a[i],o=!1;continue}if(r.i){if(s){if(a[i].match(/[a-z]/)){u?(n+=a[i],n+=`${a[i-2]}-${a[i]}`.toUpperCase(),u=!1):a[i+1]==="-"&&a[i+2]?.match(/[a-z]/)?(n+=a[i],u=!0):n+=`${a[i]}${a[i].toUpperCase()}`;continue}}else if(a[i].match(/[a-z]/)){n+=`[${a[i]}${a[i].toUpperCase()}]`;continue}}if(r.m){if(a[i]==="^"){n+=`(^|(?<=[\r
]))`;continue}else if(a[i]==="$"){n+=`($|(?=[\r
]))`;continue}}if(r.s&&a[i]==="."){n+=s?`${a[i]}\r
`:`[${a[i]}\r
]`;continue}n+=a[i],a[i]==="\\"?o=!0:s&&a[i]==="]"?s=!1:!s&&a[i]==="["&&(s=!0)}try{new RegExp(n)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return n}function Gr(e,t){if(t.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),t.target==="openApi3"&&e.keyType?._def.typeName===d.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((a,n)=>({...a,[n]:y(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",n]})??P(t)}),{}),additionalProperties:t.rejectedAdditionalProperties};const r={type:"object",additionalProperties:y(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??t.allowedAdditionalProperties};if(t.target==="openApi3")return r;if(e.keyType?._def.typeName===d.ZodString&&e.keyType._def.checks?.length){const{type:a,...n}=qr(e.keyType._def,t);return{...r,propertyNames:n}}else{if(e.keyType?._def.typeName===d.ZodEnum)return{...r,propertyNames:{enum:e.keyType._def.values}};if(e.keyType?._def.typeName===d.ZodBranded&&e.keyType._def.type._def.typeName===d.ZodString&&e.keyType._def.type._def.checks?.length){const{type:a,...n}=Jr(e.keyType._def,t);return{...r,propertyNames:n}}}return r}function Xn(e,t){if(t.mapStrategy==="record")return Gr(e,t);const r=y(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||P(t),a=y(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||P(t);return{type:"array",maxItems:125,items:{type:"array",items:[r,a],minItems:2,maxItems:2}}}function Hn(e){const t=e.values,a=Object.keys(e.values).filter(o=>typeof t[t[o]]!="number").map(o=>t[o]),n=Array.from(new Set(a.map(o=>typeof o)));return{type:n.length===1?n[0]==="string"?"string":"number":["string","number"],enum:a}}function Qn(e){return e.target==="openAi"?void 0:{not:P({...e,currentPath:[...e.currentPath,"not"]})}}function eo(e){return e.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const Ee={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function to(e,t){if(t.target==="openApi3")return Xt(e,t);const r=e.options instanceof Map?Array.from(e.options.values()):e.options;if(r.every(a=>a._def.typeName in Ee&&(!a._def.checks||!a._def.checks.length))){const a=r.reduce((n,o)=>{const s=Ee[o._def.typeName];return s&&!n.includes(s)?[...n,s]:n},[]);return{type:a.length>1?a:a[0]}}else if(r.every(a=>a._def.typeName==="ZodLiteral"&&!a.description)){const a=r.reduce((n,o)=>{const s=typeof o._def.value;switch(s){case"string":case"number":case"boolean":return[...n,s];case"bigint":return[...n,"integer"];case"object":if(o._def.value===null)return[...n,"null"];case"symbol":case"undefined":case"function":default:return n}},[]);if(a.length===r.length){const n=a.filter((o,s,u)=>u.indexOf(o)===s);return{type:n.length>1?n:n[0],enum:r.reduce((o,s)=>o.includes(s._def.value)?o:[...o,s._def.value],[])}}}else if(r.every(a=>a._def.typeName==="ZodEnum"))return{type:"string",enum:r.reduce((a,n)=>[...a,...n._def.values.filter(o=>!a.includes(o))],[])};return Xt(e,t)}const Xt=(e,t)=>{const r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((a,n)=>y(a._def,{...t,currentPath:[...t.currentPath,"anyOf",`${n}`]})).filter(a=>!!a&&(!t.strictUnions||typeof a=="object"&&Object.keys(a).length>0));return r.length?{anyOf:r}:void 0};function ro(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return t.target==="openApi3"?{type:Ee[e.innerType._def.typeName],nullable:!0}:{type:[Ee[e.innerType._def.typeName],"null"]};if(t.target==="openApi3"){const a=y(e.innerType._def,{...t,currentPath:[...t.currentPath]});return a&&"$ref"in a?{allOf:[a],nullable:!0}:a&&{...a,nullable:!0}}const r=y(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}function ao(e,t){const r={type:"number"};if(!e.checks)return r;for(const a of e.checks)switch(a.kind){case"int":r.type="integer",Vr(r,"type",a.message,t);break;case"min":t.target==="jsonSchema7"?a.inclusive?v(r,"minimum",a.value,a.message,t):v(r,"exclusiveMinimum",a.value,a.message,t):(a.inclusive||(r.exclusiveMinimum=!0),v(r,"minimum",a.value,a.message,t));break;case"max":t.target==="jsonSchema7"?a.inclusive?v(r,"maximum",a.value,a.message,t):v(r,"exclusiveMaximum",a.value,a.message,t):(a.inclusive||(r.exclusiveMaximum=!0),v(r,"maximum",a.value,a.message,t));break;case"multipleOf":v(r,"multipleOf",a.value,a.message,t);break}return r}function no(e,t){const r=t.target==="openAi",a={type:"object",properties:{}},n=[],o=e.shape();for(const u in o){let i=o[u];if(i===void 0||i._def===void 0)continue;let l=so(i);l&&r&&(i._def.typeName==="ZodOptional"&&(i=i._def.innerType),i.isNullable()||(i=i.nullable()),l=!1);const c=y(i._def,{...t,currentPath:[...t.currentPath,"properties",u],propertyPath:[...t.currentPath,"properties",u]});c!==void 0&&(a.properties[u]=c,l||n.push(u))}n.length&&(a.required=n);const s=oo(e,t);return s!==void 0&&(a.additionalProperties=s),a}function oo(e,t){if(e.catchall._def.typeName!=="ZodNever")return y(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return t.removeAdditionalStrategy==="strict"?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}function so(e){try{return e.isOptional()}catch{return!0}}const io=(e,t)=>{if(t.currentPath.toString()===t.propertyPath?.toString())return y(e.innerType._def,t);const r=y(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return r?{anyOf:[{not:P(t)},r]}:P(t)},uo=(e,t)=>{if(t.pipeStrategy==="input")return y(e.in._def,t);if(t.pipeStrategy==="output")return y(e.out._def,t);const r=y(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),a=y(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,a].filter(n=>n!==void 0)}};function lo(e,t){return y(e.type._def,t)}function co(e,t){const a={type:"array",uniqueItems:!0,items:y(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&v(a,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&v(a,"maxItems",e.maxSize.value,e.maxSize.message,t),a}function po(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((r,a)=>y(r._def,{...t,currentPath:[...t.currentPath,"items",`${a}`]})).reduce((r,a)=>a===void 0?r:[...r,a],[]),additionalItems:y(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((r,a)=>y(r._def,{...t,currentPath:[...t.currentPath,"items",`${a}`]})).reduce((r,a)=>a===void 0?r:[...r,a],[])}}function fo(e){return{not:P(e)}}function mo(e){return P(e)}const go=(e,t)=>y(e.innerType._def,t),ho=(e,t,r)=>{switch(t){case d.ZodString:return qr(e,r);case d.ZodNumber:return ao(e,r);case d.ZodObject:return no(e,r);case d.ZodBigInt:return Fn(e,r);case d.ZodBoolean:return Ln();case d.ZodDate:return zr(e,r);case d.ZodUndefined:return fo(r);case d.ZodNull:return eo(r);case d.ZodArray:return Un(e,r);case d.ZodUnion:case d.ZodDiscriminatedUnion:return to(e,r);case d.ZodIntersection:return Gn(e,r);case d.ZodTuple:return po(e,r);case d.ZodRecord:return Gr(e,r);case d.ZodLiteral:return Kn(e,r);case d.ZodEnum:return zn(e);case d.ZodNativeEnum:return Hn(e);case d.ZodNullable:return ro(e,r);case d.ZodOptional:return io(e,r);case d.ZodMap:return Xn(e,r);case d.ZodSet:return co(e,r);case d.ZodLazy:return()=>e.getter()._def;case d.ZodPromise:return lo(e,r);case d.ZodNaN:case d.ZodNever:return Qn(r);case d.ZodEffects:return Jn(e,r);case d.ZodAny:return P(r);case d.ZodUnknown:return mo(r);case d.ZodDefault:return Bn(e,r);case d.ZodBranded:return Jr(e,r);case d.ZodReadonly:return go(e,r);case d.ZodCatch:return Zn(e,r);case d.ZodPipeline:return uo(e,r);case d.ZodFunction:case d.ZodVoid:case d.ZodSymbol:return;default:return(a=>{})()}};function y(e,t,r=!1){const a=t.seen.get(e);if(t.override){const u=t.override?.(e,t,a,r);if(u!==$n)return u}if(a&&!r){const u=yo(a,t);if(u!==void 0)return u}const n={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,n);const o=ho(e,e.typeName,t),s=typeof o=="function"?y(o(),t):o;if(s&&vo(e,t,s),t.postProcess){const u=t.postProcess(s,e,t);return n.jsonSchema=s,u}return n.jsonSchema=s,s}const yo=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:Br(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((r,a)=>t.currentPath[a]===r)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),P(t)):t.$refStrategy==="seen"?P(t):void 0}},vo=(e,t,r)=>(e.description&&(r.description=e.description,t.markdownDescription&&(r.markdownDescription=e.description)),r),_o=(e,t)=>{const r=jn(t);let a=typeof t=="object"&&t.definitions?Object.entries(t.definitions).reduce((i,[l,c])=>({...i,[l]:y(c._def,{...r,currentPath:[...r.basePath,r.definitionPath,l]},!0)??P(r)}),{}):void 0;const n=typeof t=="string"?t:t?.nameStrategy==="title"?void 0:t?.name,o=y(e._def,n===void 0?r:{...r,currentPath:[...r.basePath,r.definitionPath,n]},!1)??P(r),s=typeof t=="object"&&t.name!==void 0&&t.nameStrategy==="title"?t.name:void 0;s!==void 0&&(o.title=s),r.flags.hasReferencedOpenAiAnyType&&(a||(a={}),a[r.openAiAnyTypeName]||(a[r.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:r.$refStrategy==="relative"?"1":[...r.basePath,r.definitionPath,r.openAiAnyTypeName].join("/")}}));const u=n===void 0?a?{...o,[r.definitionPath]:a}:o:{$ref:[...r.$refStrategy==="relative"?[]:r.basePath,r.definitionPath,n].join("/"),[r.definitionPath]:{...a,[n]:o}};return r.target==="jsonSchema7"?u.$schema="http://json-schema.org/draft-07/schema#":(r.target==="jsonSchema2019-09"||r.target==="openAi")&&(u.$schema="https://json-schema.org/draft/2019-09/schema#"),r.target==="openAi"&&("anyOf"in u||"oneOf"in u||"allOf"in u||"type"in u&&Array.isArray(u.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),u};var pe={code:"0",name:"text",parse:e=>{if(typeof e!="string")throw new Error('"text" parts expect a string value.');return{type:"text",value:e}}},de={code:"3",name:"error",parse:e=>{if(typeof e!="string")throw new Error('"error" parts expect a string value.');return{type:"error",value:e}}},fe={code:"4",name:"assistant_message",parse:e=>{if(e==null||typeof e!="object"||!("id"in e)||!("role"in e)||!("content"in e)||typeof e.id!="string"||typeof e.role!="string"||e.role!=="assistant"||!Array.isArray(e.content)||!e.content.every(t=>t!=null&&typeof t=="object"&&"type"in t&&t.type==="text"&&"text"in t&&t.text!=null&&typeof t.text=="object"&&"value"in t.text&&typeof t.text.value=="string"))throw new Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},me={code:"5",name:"assistant_control_data",parse:e=>{if(e==null||typeof e!="object"||!("threadId"in e)||!("messageId"in e)||typeof e.threadId!="string"||typeof e.messageId!="string")throw new Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},ge={code:"6",name:"data_message",parse:e=>{if(e==null||typeof e!="object"||!("role"in e)||!("data"in e)||typeof e.role!="string"||e.role!=="data")throw new Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}},bo=[pe,de,fe,me,ge];pe.code+"",de.code+"",fe.code+"",me.code+"",ge.code+"";pe.name+"",pe.code,de.name+"",de.code,fe.name+"",fe.code,me.name+"",me.code,ge.name+"",ge.code;bo.map(e=>e.code);function So(e){const t=["ROOT"];let r=-1,a=null;function n(i,l,c){switch(i){case'"':{r=l,t.pop(),t.push(c),t.push("INSIDE_STRING");break}case"f":case"t":case"n":{r=l,a=l,t.pop(),t.push(c),t.push("INSIDE_LITERAL");break}case"-":{t.pop(),t.push(c),t.push("INSIDE_NUMBER");break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{r=l,t.pop(),t.push(c),t.push("INSIDE_NUMBER");break}case"{":{r=l,t.pop(),t.push(c),t.push("INSIDE_OBJECT_START");break}case"[":{r=l,t.pop(),t.push(c),t.push("INSIDE_ARRAY_START");break}}}function o(i,l){switch(i){case",":{t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break}case"}":{r=l,t.pop();break}}}function s(i,l){switch(i){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{r=l,t.pop();break}}}for(let i=0;i<e.length;i++){const l=e[i];switch(t[t.length-1]){case"ROOT":n(l,i,"FINISH");break;case"INSIDE_OBJECT_START":{switch(l){case'"':{t.pop(),t.push("INSIDE_OBJECT_KEY");break}case"}":{r=i,t.pop();break}}break}case"INSIDE_OBJECT_AFTER_COMMA":{switch(l){case'"':{t.pop(),t.push("INSIDE_OBJECT_KEY");break}}break}case"INSIDE_OBJECT_KEY":{switch(l){case'"':{t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY");break}}break}case"INSIDE_OBJECT_AFTER_KEY":{switch(l){case":":{t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE");break}}break}case"INSIDE_OBJECT_BEFORE_VALUE":{n(l,i,"INSIDE_OBJECT_AFTER_VALUE");break}case"INSIDE_OBJECT_AFTER_VALUE":{o(l,i);break}case"INSIDE_STRING":{switch(l){case'"':{t.pop(),r=i;break}case"\\":{t.push("INSIDE_STRING_ESCAPE");break}default:r=i}break}case"INSIDE_ARRAY_START":{switch(l){case"]":{r=i,t.pop();break}default:{r=i,n(l,i,"INSIDE_ARRAY_AFTER_VALUE");break}}break}case"INSIDE_ARRAY_AFTER_VALUE":{switch(l){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{r=i,t.pop();break}default:{r=i;break}}break}case"INSIDE_ARRAY_AFTER_COMMA":{n(l,i,"INSIDE_ARRAY_AFTER_VALUE");break}case"INSIDE_STRING_ESCAPE":{t.pop(),r=i;break}case"INSIDE_NUMBER":{switch(l){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{r=i;break}case"e":case"E":case"-":case".":break;case",":{t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&s(l,i),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&o(l,i);break}case"}":{t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&o(l,i);break}case"]":{t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&s(l,i);break}default:{t.pop();break}}break}case"INSIDE_LITERAL":{const p=e.substring(a,i+1);!"false".startsWith(p)&&!"true".startsWith(p)&&!"null".startsWith(p)?(t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?o(l,i):t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&s(l,i)):r=i;break}}}let u=e.slice(0,r+1);for(let i=t.length-1;i>=0;i--)switch(t[i]){case"INSIDE_STRING":{u+='"';break}case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":{u+="}";break}case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":{u+="]";break}case"INSIDE_LITERAL":{const c=e.substring(a,e.length);"true".startsWith(c)?u+="true".slice(c.length):"false".startsWith(c)?u+="false".slice(c.length):"null".startsWith(c)&&(u+="null".slice(c.length))}}return u}function To(e){if(e===void 0)return{value:void 0,state:"undefined-input"};let t=Kt({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=Kt({text:So(e)}),t.success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}var wo={code:"0",name:"text",parse:e=>{if(typeof e!="string")throw new Error('"text" parts expect a string value.');return{type:"text",value:e}}},xo={code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw new Error('"data" parts expect an array value.');return{type:"data",value:e}}},Ao={code:"3",name:"error",parse:e=>{if(typeof e!="string")throw new Error('"error" parts expect a string value.');return{type:"error",value:e}}},Io={code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw new Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:e}}},Eo={code:"9",name:"tool_call",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("toolName"in e)||typeof e.toolName!="string"||!("args"in e)||typeof e.args!="object")throw new Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:e}}},Ro={code:"a",name:"tool_result",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("result"in e))throw new Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:e}}},ko={code:"b",name:"tool_call_streaming_start",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("toolName"in e)||typeof e.toolName!="string")throw new Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:e}}},Po={code:"c",name:"tool_call_delta",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("argsTextDelta"in e)||typeof e.argsTextDelta!="string")throw new Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:e}}},No={code:"d",name:"finish_message",parse:e=>{if(e==null||typeof e!="object"||!("finishReason"in e)||typeof e.finishReason!="string")throw new Error('"finish_message" parts expect an object with a "finishReason" property.');const t={finishReason:e.finishReason};return"usage"in e&&e.usage!=null&&typeof e.usage=="object"&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:typeof e.usage.promptTokens=="number"?e.usage.promptTokens:Number.NaN,completionTokens:typeof e.usage.completionTokens=="number"?e.usage.completionTokens:Number.NaN}),{type:"finish_message",value:t}}},Oo={code:"e",name:"finish_step",parse:e=>{if(e==null||typeof e!="object"||!("finishReason"in e)||typeof e.finishReason!="string")throw new Error('"finish_step" parts expect an object with a "finishReason" property.');const t={finishReason:e.finishReason,isContinued:!1};return"usage"in e&&e.usage!=null&&typeof e.usage=="object"&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:typeof e.usage.promptTokens=="number"?e.usage.promptTokens:Number.NaN,completionTokens:typeof e.usage.completionTokens=="number"?e.usage.completionTokens:Number.NaN}),"isContinued"in e&&typeof e.isContinued=="boolean"&&(t.isContinued=e.isContinued),{type:"finish_step",value:t}}},Mo={code:"f",name:"start_step",parse:e=>{if(e==null||typeof e!="object"||!("messageId"in e)||typeof e.messageId!="string")throw new Error('"start_step" parts expect an object with an "id" property.');return{type:"start_step",value:{messageId:e.messageId}}}},Co={code:"g",name:"reasoning",parse:e=>{if(typeof e!="string")throw new Error('"reasoning" parts expect a string value.');return{type:"reasoning",value:e}}},$o={code:"h",name:"source",parse:e=>{if(e==null||typeof e!="object")throw new Error('"source" parts expect a Source object.');return{type:"source",value:e}}},Do={code:"i",name:"redacted_reasoning",parse:e=>{if(e==null||typeof e!="object"||!("data"in e)||typeof e.data!="string")throw new Error('"redacted_reasoning" parts expect an object with a "data" property.');return{type:"redacted_reasoning",value:{data:e.data}}}},jo={code:"j",name:"reasoning_signature",parse:e=>{if(e==null||typeof e!="object"||!("signature"in e)||typeof e.signature!="string")throw new Error('"reasoning_signature" parts expect an object with a "signature" property.');return{type:"reasoning_signature",value:{signature:e.signature}}}},Uo={code:"k",name:"file",parse:e=>{if(e==null||typeof e!="object"||!("data"in e)||typeof e.data!="string"||!("mimeType"in e)||typeof e.mimeType!="string")throw new Error('"file" parts expect an object with a "data" and "mimeType" property.');return{type:"file",value:e}}},Me=[wo,xo,Ao,Io,Eo,Ro,ko,Po,No,Oo,Mo,Co,$o,Do,jo,Uo];Object.fromEntries(Me.map(e=>[e.code,e]));Object.fromEntries(Me.map(e=>[e.name,e.code]));Me.map(e=>e.code);function Kr(e,t){const r=Me.find(a=>a.name===e);if(!r)throw new Error(`Invalid stream part type: ${e}`);return`${r.code}:${JSON.stringify(t)}
`}function Fo(e,t){var r;const a=(r=void 0)!=null?r:!1;return Lo(_o(e,{$refStrategy:a?"root":"none",target:"jsonSchema7"}),{validate:n=>{const o=e.safeParse(n);return o.success?{success:!0,value:o.data}:{success:!1,error:o.error}}})}var tt=Symbol.for("vercel.ai.schema");function Lo(e,{validate:t}={}){return{[tt]:!0,_type:void 0,[Ie]:!0,jsonSchema:e,validate:t}}function Zo(e){return typeof e=="object"&&e!==null&&tt in e&&e[tt]===!0&&"jsonSchema"in e&&"validate"in e}function Ce(e){return Zo(e)?e:Fo(e)}var Vo=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{},K="1.9.0",Ht=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function Bo(e){var t=new Set([e]),r=new Set,a=e.match(Ht);if(!a)return function(){return!1};var n={major:+a[1],minor:+a[2],patch:+a[3],prerelease:a[4]};if(n.prerelease!=null)return function(i){return i===e};function o(u){return r.add(u),!1}function s(u){return t.add(u),!0}return function(i){if(t.has(i))return!0;if(r.has(i))return!1;var l=i.match(Ht);if(!l)return o(i);var c={major:+l[1],minor:+l[2],patch:+l[3],prerelease:l[4]};return c.prerelease!=null||n.major!==c.major?o(i):n.major===0?n.minor===c.minor&&n.patch<=c.patch?s(i):o(i):n.minor<=c.minor?s(i):o(i)}}var Jo=Bo(K),zo=K.split(".")[0],he=Symbol.for("opentelemetry.js.api."+zo),ye=Vo;function ut(e,t,r,a){var n;a===void 0&&(a=!1);var o=ye[he]=(n=ye[he])!==null&&n!==void 0?n:{version:K};if(!a&&o[e]){var s=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return r.error(s.stack||s.message),!1}if(o.version!==K){var s=new Error("@opentelemetry/api: Registration of version v"+o.version+" for "+e+" does not match previously registered API v"+K);return r.error(s.stack||s.message),!1}return o[e]=t,r.debug("@opentelemetry/api: Registered a global for "+e+" v"+K+"."),!0}function ve(e){var t,r,a=(t=ye[he])===null||t===void 0?void 0:t.version;if(!(!a||!Jo(a)))return(r=ye[he])===null||r===void 0?void 0:r[e]}function lt(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v"+K+".");var r=ye[he];r&&delete r[e]}var qo=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var a=r.call(e),n,o=[],s;try{for(;(t===void 0||t-- >0)&&!(n=a.next()).done;)o.push(n.value)}catch(u){s={error:u}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(s)throw s.error}}return o},Go=function(e,t,r){if(r||arguments.length===2)for(var a=0,n=t.length,o;a<n;a++)(o||!(a in t))&&(o||(o=Array.prototype.slice.call(t,0,a)),o[a]=t[a]);return e.concat(o||Array.prototype.slice.call(t))},Ko=function(){function e(t){this._namespace=t.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return ue("debug",this._namespace,t)},e.prototype.error=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return ue("error",this._namespace,t)},e.prototype.info=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return ue("info",this._namespace,t)},e.prototype.warn=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return ue("warn",this._namespace,t)},e.prototype.verbose=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return ue("verbose",this._namespace,t)},e}();function ue(e,t,r){var a=ve("diag");if(a)return r.unshift(t),a[e].apply(a,Go([],qo(r),!1))}var C;(function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"})(C||(C={}));function Wo(e,t){e<C.NONE?e=C.NONE:e>C.ALL&&(e=C.ALL),t=t||{};function r(a,n){var o=t[a];return typeof o=="function"&&e>=n?o.bind(t):function(){}}return{error:r("error",C.ERROR),warn:r("warn",C.WARN),info:r("info",C.INFO),debug:r("debug",C.DEBUG),verbose:r("verbose",C.VERBOSE)}}var Yo=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var a=r.call(e),n,o=[],s;try{for(;(t===void 0||t-- >0)&&!(n=a.next()).done;)o.push(n.value)}catch(u){s={error:u}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(s)throw s.error}}return o},Xo=function(e,t,r){if(r||arguments.length===2)for(var a=0,n=t.length,o;a<n;a++)(o||!(a in t))&&(o||(o=Array.prototype.slice.call(t,0,a)),o[a]=t[a]);return e.concat(o||Array.prototype.slice.call(t))},Ho="diag",Re=function(){function e(){function t(n){return function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];var u=ve("diag");if(u)return u[n].apply(u,Xo([],Yo(o),!1))}}var r=this,a=function(n,o){var s,u,i;if(o===void 0&&(o={logLevel:C.INFO}),n===r){var l=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return r.error((s=l.stack)!==null&&s!==void 0?s:l.message),!1}typeof o=="number"&&(o={logLevel:o});var c=ve("diag"),p=Wo((u=o.logLevel)!==null&&u!==void 0?u:C.INFO,n);if(c&&!o.suppressOverrideMessage){var b=(i=new Error().stack)!==null&&i!==void 0?i:"<failed to generate stacktrace>";c.warn("Current logger will be overwritten from "+b),p.warn("Current logger will overwrite one already registered from "+b)}return ut("diag",p,r,!0)};r.setLogger=a,r.disable=function(){lt(Ho,r)},r.createComponentLogger=function(n){return new Ko(n)},r.verbose=t("verbose"),r.debug=t("debug"),r.info=t("info"),r.warn=t("warn"),r.error=t("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e}();function Qo(e){return Symbol.for(e)}var es=function(){function e(t){var r=this;r._currentContext=t?new Map(t):new Map,r.getValue=function(a){return r._currentContext.get(a)},r.setValue=function(a,n){var o=new e(r._currentContext);return o._currentContext.set(a,n),o},r.deleteValue=function(a){var n=new e(r._currentContext);return n._currentContext.delete(a),n}}return e}(),ts=new es,rs=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var a=r.call(e),n,o=[],s;try{for(;(t===void 0||t-- >0)&&!(n=a.next()).done;)o.push(n.value)}catch(u){s={error:u}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(s)throw s.error}}return o},as=function(e,t,r){if(r||arguments.length===2)for(var a=0,n=t.length,o;a<n;a++)(o||!(a in t))&&(o||(o=Array.prototype.slice.call(t,0,a)),o[a]=t[a]);return e.concat(o||Array.prototype.slice.call(t))},ns=function(){function e(){}return e.prototype.active=function(){return ts},e.prototype.with=function(t,r,a){for(var n=[],o=3;o<arguments.length;o++)n[o-3]=arguments[o];return r.call.apply(r,as([a],rs(n),!1))},e.prototype.bind=function(t,r){return r},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}(),os=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var a=r.call(e),n,o=[],s;try{for(;(t===void 0||t-- >0)&&!(n=a.next()).done;)o.push(n.value)}catch(u){s={error:u}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(s)throw s.error}}return o},ss=function(e,t,r){if(r||arguments.length===2)for(var a=0,n=t.length,o;a<n;a++)(o||!(a in t))&&(o||(o=Array.prototype.slice.call(t,0,a)),o[a]=t[a]);return e.concat(o||Array.prototype.slice.call(t))},Je="context",is=new ns,Wr=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(t){return ut(Je,t,Re.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(t,r,a){for(var n,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return(n=this._getContextManager()).with.apply(n,ss([t,r,a],os(o),!1))},e.prototype.bind=function(t,r){return this._getContextManager().bind(t,r)},e.prototype._getContextManager=function(){return ve(Je)||is},e.prototype.disable=function(){this._getContextManager().disable(),lt(Je,Re.instance())},e}(),rt;(function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"})(rt||(rt={}));var Yr="0000000000000000",Xr="00000000000000000000000000000000",us={traceId:Xr,spanId:Yr,traceFlags:rt.NONE},le=function(){function e(t){t===void 0&&(t=us),this._spanContext=t}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(t,r){return this},e.prototype.setAttributes=function(t){return this},e.prototype.addEvent=function(t,r){return this},e.prototype.addLink=function(t){return this},e.prototype.addLinks=function(t){return this},e.prototype.setStatus=function(t){return this},e.prototype.updateName=function(t){return this},e.prototype.end=function(t){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(t,r){},e}(),ct=Qo("OpenTelemetry Context Key SPAN");function pt(e){return e.getValue(ct)||void 0}function ls(){return pt(Wr.getInstance().active())}function dt(e,t){return e.setValue(ct,t)}function cs(e){return e.deleteValue(ct)}function ps(e,t){return dt(e,new le(t))}function Hr(e){var t;return(t=pt(e))===null||t===void 0?void 0:t.spanContext()}var ds=/^([0-9a-f]{32})$/i,fs=/^[0-9a-f]{16}$/i;function ms(e){return ds.test(e)&&e!==Xr}function gs(e){return fs.test(e)&&e!==Yr}function Qr(e){return ms(e.traceId)&&gs(e.spanId)}function hs(e){return new le(e)}var ze=Wr.getInstance(),ea=function(){function e(){}return e.prototype.startSpan=function(t,r,a){a===void 0&&(a=ze.active());var n=!!r?.root;if(n)return new le;var o=a&&Hr(a);return ys(o)&&Qr(o)?new le(o):new le},e.prototype.startActiveSpan=function(t,r,a,n){var o,s,u;if(!(arguments.length<2)){arguments.length===2?u=r:arguments.length===3?(o=r,u=a):(o=r,s=a,u=n);var i=s??ze.active(),l=this.startSpan(t,o,i),c=dt(i,l);return ze.with(c,u,void 0,l)}},e}();function ys(e){return typeof e=="object"&&typeof e.spanId=="string"&&typeof e.traceId=="string"&&typeof e.traceFlags=="number"}var vs=new ea,_s=function(){function e(t,r,a,n){this._provider=t,this.name=r,this.version=a,this.options=n}return e.prototype.startSpan=function(t,r,a){return this._getTracer().startSpan(t,r,a)},e.prototype.startActiveSpan=function(t,r,a,n){var o=this._getTracer();return Reflect.apply(o.startActiveSpan,o,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var t=this._provider.getDelegateTracer(this.name,this.version,this.options);return t?(this._delegate=t,this._delegate):vs},e}(),bs=function(){function e(){}return e.prototype.getTracer=function(t,r,a){return new ea},e}(),Ss=new bs,Qt=function(){function e(){}return e.prototype.getTracer=function(t,r,a){var n;return(n=this.getDelegateTracer(t,r,a))!==null&&n!==void 0?n:new _s(this,t,r,a)},e.prototype.getDelegate=function(){var t;return(t=this._delegate)!==null&&t!==void 0?t:Ss},e.prototype.setDelegate=function(t){this._delegate=t},e.prototype.getDelegateTracer=function(t,r,a){var n;return(n=this._delegate)===null||n===void 0?void 0:n.getTracer(t,r,a)},e}(),ke;(function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"})(ke||(ke={}));var qe="trace",Ts=function(){function e(){this._proxyTracerProvider=new Qt,this.wrapSpanContext=hs,this.isSpanContextValid=Qr,this.deleteSpan=cs,this.getSpan=pt,this.getActiveSpan=ls,this.getSpanContext=Hr,this.setSpan=dt,this.setSpanContext=ps}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(t){var r=ut(qe,this._proxyTracerProvider,Re.instance());return r&&this._proxyTracerProvider.setDelegate(t),r},e.prototype.getTracerProvider=function(){return ve(qe)||this._proxyTracerProvider},e.prototype.getTracer=function(t,r){return this.getTracerProvider().getTracer(t,r)},e.prototype.disable=function(){lt(qe,Re.instance()),this._proxyTracerProvider=new Qt},e}(),ws=Ts.getInstance(),xs=Object.defineProperty,ft=(e,t)=>{for(var r in t)xs(e,r,{get:t[r],enumerable:!0})};function ta(e,{contentType:t,dataStreamVersion:r}){const a=new Headers(e??{});return a.has("Content-Type")||a.set("Content-Type",t),a.set("X-Vercel-AI-Data-Stream",r),a}var As=class extends h{constructor(){super({name:"AI_UnsupportedModelVersionError",message:'Unsupported model version. AI SDK 4 only supports models that implement specification version "v1". Please upgrade to AI SDK 5 to use this model.'})}},ra="AI_InvalidArgumentError",aa=`vercel.ai.error.${ra}`,Is=Symbol.for(aa),na,U=class extends h{constructor({parameter:e,value:t,message:r}){super({name:ra,message:`Invalid argument for parameter ${e}: ${r}`}),this[na]=!0,this.parameter=e,this.value=t}static isInstance(e){return h.hasMarker(e,aa)}};na=Is;var oa="AI_RetryError",sa=`vercel.ai.error.${oa}`,Es=Symbol.for(sa),ia,er=class extends h{constructor({message:e,reason:t,errors:r}){super({name:oa,message:e}),this[ia]=!0,this.reason=t,this.errors=r,this.lastError=r[r.length-1]}static isInstance(e){return h.hasMarker(e,sa)}};ia=Es;var Rs=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:r=2}={})=>async a=>ua(a,{maxRetries:e,delayInMs:t,backoffFactor:r});async function ua(e,{maxRetries:t,delayInMs:r,backoffFactor:a},n=[]){try{return await e()}catch(o){if(gn(o)||t===0)throw o;const s=mn(o),u=[...n,o],i=u.length;if(i>t)throw new er({message:`Failed after ${i} attempts. Last error: ${s}`,reason:"maxRetriesExceeded",errors:u});if(o instanceof Error&&nn.isInstance(o)&&o.isRetryable===!0&&i<=t)return await fn(r),ua(e,{maxRetries:t,delayInMs:a*r,backoffFactor:a},u);throw i===1?o:new er({message:`Failed after ${i} attempts with non-retryable error: '${s}'`,reason:"errorNotRetryable",errors:u})}}function ks({maxRetries:e}){if(e!=null){if(!Number.isInteger(e))throw new U({parameter:"maxRetries",value:e,message:"maxRetries must be an integer"});if(e<0)throw new U({parameter:"maxRetries",value:e,message:"maxRetries must be >= 0"})}const t=e??2;return{maxRetries:t,retry:Rs({maxRetries:t})}}function at({operationId:e,telemetry:t}){return{"operation.name":`${e}${t?.functionId!=null?` ${t.functionId}`:""}`,"resource.name":t?.functionId,"ai.operationId":e,"ai.telemetry.functionId":t?.functionId}}function Ps({model:e,settings:t,telemetry:r,headers:a}){var n;return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((o,[s,u])=>(o[`ai.settings.${s}`]=u,o),{}),...Object.entries((n=r?.metadata)!=null?n:{}).reduce((o,[s,u])=>(o[`ai.telemetry.metadata.${s}`]=u,o),{}),...Object.entries(a??{}).reduce((o,[s,u])=>(u!==void 0&&(o[`ai.request.headers.${s}`]=u),o),{})}}var Ns={startSpan(){return xe},startActiveSpan(e,t,r,a){if(typeof t=="function")return t(xe);if(typeof r=="function")return r(xe);if(typeof a=="function")return a(xe)}},xe={spanContext(){return Os},setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording(){return!1},recordException(){return this}},Os={traceId:"",spanId:"",traceFlags:0};function Ms({isEnabled:e=!1,tracer:t}={}){return e?t||ws.getTracer("ai"):Ns}function nt({name:e,tracer:t,attributes:r,fn:a,endWhenDone:n=!0}){return t.startActiveSpan(e,{attributes:r},async o=>{try{const s=await a(o);return n&&o.end(),s}catch(s){try{la(o,s)}finally{o.end()}throw s}})}function la(e,t){t instanceof Error?(e.recordException({name:t.name,message:t.message,stack:t.stack}),e.setStatus({code:ke.ERROR,message:t.message})):e.setStatus({code:ke.ERROR})}function ae({telemetry:e,attributes:t}){return e?.isEnabled!==!0?{}:Object.entries(t).reduce((r,[a,n])=>{if(n===void 0)return r;if(typeof n=="object"&&"input"in n&&typeof n.input=="function"){if(e?.recordInputs===!1)return r;const o=n.input();return o===void 0?r:{...r,[a]:o}}if(typeof n=="object"&&"output"in n&&typeof n.output=="function"){if(e?.recordOutputs===!1)return r;const o=n.output();return o===void 0?r:{...r,[a]:o}}return{...r,[a]:n}},{})}var Cs=class{constructor({data:e,mimeType:t}){const r=e instanceof Uint8Array;this.base64Data=r?void 0:e,this.uint8ArrayData=r?e:void 0,this.mimeType=t}get base64(){return this.base64Data==null&&(this.base64Data=Qe(this.uint8ArrayData)),this.base64Data}get uint8Array(){return this.uint8ArrayData==null&&(this.uint8ArrayData=it(this.base64Data)),this.uint8ArrayData}},$s=[{mimeType:"image/gif",bytesPrefix:[71,73,70],base64Prefix:"R0lG"},{mimeType:"image/png",bytesPrefix:[137,80,78,71],base64Prefix:"iVBORw"},{mimeType:"image/jpeg",bytesPrefix:[255,216],base64Prefix:"/9j/"},{mimeType:"image/webp",bytesPrefix:[82,73,70,70],base64Prefix:"UklGRg"},{mimeType:"image/bmp",bytesPrefix:[66,77],base64Prefix:"Qk"},{mimeType:"image/tiff",bytesPrefix:[73,73,42,0],base64Prefix:"SUkqAA"},{mimeType:"image/tiff",bytesPrefix:[77,77,0,42],base64Prefix:"TU0AKg"},{mimeType:"image/avif",bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102],base64Prefix:"AAAAIGZ0eXBhdmlm"},{mimeType:"image/heic",bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99],base64Prefix:"AAAAIGZ0eXBoZWlj"}],Ds=e=>{const t=typeof e=="string"?it(e):e,r=(t[6]&127)<<21|(t[7]&127)<<14|(t[8]&127)<<7|t[9]&127;return t.slice(r+10)};function js(e){return typeof e=="string"&&e.startsWith("SUQz")||typeof e!="string"&&e.length>10&&e[0]===73&&e[1]===68&&e[2]===51?Ds(e):e}function Us({data:e,signatures:t}){const r=js(e);for(const a of t)if(typeof r=="string"?r.startsWith(a.base64Prefix):r.length>=a.bytesPrefix.length&&a.bytesPrefix.every((n,o)=>r[o]===n))return a.mimeType}var ca="AI_NoObjectGeneratedError",pa=`vercel.ai.error.${ca}`,Fs=Symbol.for(pa),da,tr=class extends h{constructor({message:e="No object generated.",cause:t,text:r,response:a,usage:n,finishReason:o}){super({name:ca,message:e,cause:t}),this[da]=!0,this.text=r,this.response=a,this.usage=n,this.finishReason=o}static isInstance(e){return h.hasMarker(e,pa)}};da=Fs;var fa="AI_DownloadError",ma=`vercel.ai.error.${fa}`,Ls=Symbol.for(ma),ga,Ge=class extends h{constructor({url:e,statusCode:t,statusText:r,cause:a,message:n=a==null?`Failed to download ${e}: ${t} ${r}`:`Failed to download ${e}: ${a}`}){super({name:fa,message:n,cause:a}),this[ga]=!0,this.url=e,this.statusCode=t,this.statusText=r}static isInstance(e){return h.hasMarker(e,ma)}};ga=Ls;async function Zs({url:e}){var t;const r=e.toString();try{const a=await fetch(r);if(!a.ok)throw new Ge({url:r,statusCode:a.status,statusText:a.statusText});return{data:new Uint8Array(await a.arrayBuffer()),mimeType:(t=a.headers.get("content-type"))!=null?t:void 0}}catch(a){throw Ge.isInstance(a)?a:new Ge({url:r,cause:a})}}var ha="AI_InvalidDataContentError",ya=`vercel.ai.error.${ha}`,Vs=Symbol.for(ya),va,rr=class extends h{constructor({content:e,cause:t,message:r=`Invalid data content. Expected a base64 string, Uint8Array, ArrayBuffer, or Buffer, but got ${typeof e}.`}){super({name:ha,message:r,cause:t}),this[va]=!0,this.content=e}static isInstance(e){return h.hasMarker(e,ya)}};va=Vs;var _a=R([f(),Ae(Uint8Array),Ae(ArrayBuffer),en(e=>{var t,r;return(r=(t=globalThis.Buffer)==null?void 0:t.isBuffer(e))!=null?r:!1},{message:"Must be a Buffer"})]);function mt(e){return typeof e=="string"?e:e instanceof ArrayBuffer?Qe(new Uint8Array(e)):Qe(e)}function Pe(e){if(e instanceof Uint8Array)return e;if(typeof e=="string")try{return it(e)}catch(t){throw new rr({message:"Invalid data content. Content string is not a base64-encoded media.",content:e,cause:t})}if(e instanceof ArrayBuffer)return new Uint8Array(e);throw new rr({content:e})}function Bs(e){try{return new TextDecoder().decode(e)}catch{throw new Error("Error decoding Uint8Array to text")}}var ba="AI_InvalidMessageRoleError",Sa=`vercel.ai.error.${ba}`,Js=Symbol.for(Sa),Ta,zs=class extends h{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:ba,message:t}),this[Ta]=!0,this.role=e}static isInstance(e){return h.hasMarker(e,Sa)}};Ta=Js;function qs(e){try{const[t,r]=e.split(",");return{mimeType:t.split(";")[0].split(":")[1],base64Content:r}}catch{return{mimeType:void 0,base64Content:void 0}}}async function Gs({prompt:e,modelSupportsImageUrls:t=!0,modelSupportsUrl:r=()=>!1,downloadImplementation:a=Zs}){const n=await Ws(e.messages,a,t,r);return[...e.system!=null?[{role:"system",content:e.system}]:[],...e.messages.map(o=>Ks(o,n))]}function Ks(e,t){var r,a,n,o,s,u;const i=e.role;switch(i){case"system":return{role:"system",content:e.content,providerMetadata:(r=e.providerOptions)!=null?r:e.experimental_providerMetadata};case"user":return typeof e.content=="string"?{role:"user",content:[{type:"text",text:e.content}],providerMetadata:(a=e.providerOptions)!=null?a:e.experimental_providerMetadata}:{role:"user",content:e.content.map(l=>Ys(l,t)).filter(l=>l.type!=="text"||l.text!==""),providerMetadata:(n=e.providerOptions)!=null?n:e.experimental_providerMetadata};case"assistant":return typeof e.content=="string"?{role:"assistant",content:[{type:"text",text:e.content}],providerMetadata:(o=e.providerOptions)!=null?o:e.experimental_providerMetadata}:{role:"assistant",content:e.content.filter(l=>l.type!=="text"||l.text!=="").map(l=>{var c;const p=(c=l.providerOptions)!=null?c:l.experimental_providerMetadata;switch(l.type){case"file":return{type:"file",data:l.data instanceof URL?l.data:mt(l.data),filename:l.filename,mimeType:l.mimeType,providerMetadata:p};case"reasoning":return{type:"reasoning",text:l.text,signature:l.signature,providerMetadata:p};case"redacted-reasoning":return{type:"redacted-reasoning",data:l.data,providerMetadata:p};case"text":return{type:"text",text:l.text,providerMetadata:p};case"tool-call":return{type:"tool-call",toolCallId:l.toolCallId,toolName:l.toolName,args:l.args,providerMetadata:p}}}),providerMetadata:(s=e.providerOptions)!=null?s:e.experimental_providerMetadata};case"tool":return{role:"tool",content:e.content.map(l=>{var c;return{type:"tool-result",toolCallId:l.toolCallId,toolName:l.toolName,result:l.result,content:l.experimental_content,isError:l.isError,providerMetadata:(c=l.providerOptions)!=null?c:l.experimental_providerMetadata}}),providerMetadata:(u=e.providerOptions)!=null?u:e.experimental_providerMetadata};default:{const l=i;throw new zs({role:l})}}}async function Ws(e,t,r,a){const n=e.filter(s=>s.role==="user").map(s=>s.content).filter(s=>Array.isArray(s)).flat().filter(s=>s.type==="image"||s.type==="file").filter(s=>!(s.type==="image"&&r===!0)).map(s=>s.type==="image"?s.image:s.data).map(s=>typeof s=="string"&&(s.startsWith("http:")||s.startsWith("https:"))?new URL(s):s).filter(s=>s instanceof URL).filter(s=>!a(s)),o=await Promise.all(n.map(async s=>({url:s,data:await t({url:s})})));return Object.fromEntries(o.map(({url:s,data:u})=>[s.toString(),u]))}function Ys(e,t){var r,a,n,o;if(e.type==="text")return{type:"text",text:e.text,providerMetadata:(r=e.providerOptions)!=null?r:e.experimental_providerMetadata};let s=e.mimeType,u,i,l;const c=e.type;switch(c){case"image":u=e.image;break;case"file":u=e.data;break;default:throw new Error(`Unsupported part type: ${c}`)}try{i=typeof u=="string"?new URL(u):u}catch{i=u}if(i instanceof URL)if(i.protocol==="data:"){const{mimeType:p,base64Content:b}=qs(i.toString());if(p==null||b==null)throw new Error(`Invalid data URL format in part ${c}`);s=p,l=Pe(b)}else{const p=t[i.toString()];p?(l=p.data,s??(s=p.mimeType)):l=i}else l=Pe(i);switch(c){case"image":return l instanceof Uint8Array&&(s=(a=Us({data:l,signatures:$s}))!=null?a:s),{type:"image",image:l,mimeType:s,providerMetadata:(n=e.providerOptions)!=null?n:e.experimental_providerMetadata};case"file":{if(s==null)throw new Error("Mime type is missing for file part");return{type:"file",data:l instanceof Uint8Array?mt(l):l,filename:e.filename,mimeType:s,providerMetadata:(o=e.providerOptions)!=null?o:e.experimental_providerMetadata}}}}function Xs({maxTokens:e,temperature:t,topP:r,topK:a,presencePenalty:n,frequencyPenalty:o,stopSequences:s,seed:u}){if(e!=null){if(!Number.isInteger(e))throw new U({parameter:"maxTokens",value:e,message:"maxTokens must be an integer"});if(e<1)throw new U({parameter:"maxTokens",value:e,message:"maxTokens must be >= 1"})}if(t!=null&&typeof t!="number")throw new U({parameter:"temperature",value:t,message:"temperature must be a number"});if(r!=null&&typeof r!="number")throw new U({parameter:"topP",value:r,message:"topP must be a number"});if(a!=null&&typeof a!="number")throw new U({parameter:"topK",value:a,message:"topK must be a number"});if(n!=null&&typeof n!="number")throw new U({parameter:"presencePenalty",value:n,message:"presencePenalty must be a number"});if(o!=null&&typeof o!="number")throw new U({parameter:"frequencyPenalty",value:o,message:"frequencyPenalty must be a number"});if(u!=null&&!Number.isInteger(u))throw new U({parameter:"seed",value:u,message:"seed must be an integer"});return{maxTokens:e,temperature:t??0,topP:r,topK:a,presencePenalty:n,frequencyPenalty:o,stopSequences:s!=null&&s.length>0?s:void 0,seed:u}}function ar(e){var t,r,a;const n=[];for(const o of e){let s;try{s=new URL(o.url)}catch{throw new Error(`Invalid URL: ${o.url}`)}switch(s.protocol){case"http:":case"https:":{if((t=o.contentType)!=null&&t.startsWith("image/"))n.push({type:"image",image:s});else{if(!o.contentType)throw new Error("If the attachment is not an image, it must specify a content type");n.push({type:"file",data:s,mimeType:o.contentType})}break}case"data:":{let u,i,l;try{[u,i]=o.url.split(","),l=u.split(";")[0].split(":")[1]}catch{throw new Error(`Error processing data URL: ${o.url}`)}if(l==null||i==null)throw new Error(`Invalid data URL format: ${o.url}`);if((r=o.contentType)!=null&&r.startsWith("image/"))n.push({type:"image",image:Pe(i)});else if((a=o.contentType)!=null&&a.startsWith("text/"))n.push({type:"text",text:Bs(Pe(i))});else{if(!o.contentType)throw new Error("If the attachment is not an image or text, it must specify a content type");n.push({type:"file",data:i,mimeType:o.contentType})}break}default:throw new Error(`Unsupported URL protocol: ${s.protocol}`)}}return n}var wa="AI_MessageConversionError",xa=`vercel.ai.error.${wa}`,Hs=Symbol.for(xa),Aa,Ke=class extends h{constructor({originalMessage:e,message:t}){super({name:wa,message:t}),this[Aa]=!0,this.originalMessage=e}static isInstance(e){return h.hasMarker(e,xa)}};Aa=Hs;function Qs(e,t){var r,a;const n=(r=t?.tools)!=null?r:{},o=[];for(let s=0;s<e.length;s++){const u=e[s],i=s===e.length-1,{role:l,content:c,experimental_attachments:p}=u;switch(l){case"system":{o.push({role:"system",content:c});break}case"user":{if(u.parts==null)o.push({role:"user",content:p?[{type:"text",text:c},...ar(p)]:c});else{const b=u.parts.filter(_=>_.type==="text").map(_=>({type:"text",text:_.text}));o.push({role:"user",content:p?[...b,...ar(p)]:b})}break}case"assistant":{if(u.parts!=null){let N=function(){const x=[];for(const S of I)switch(S.type){case"file":case"text":{x.push(S);break}case"reasoning":{for(const $ of S.details)switch($.type){case"text":x.push({type:"reasoning",text:$.text,signature:$.signature});break;case"redacted":x.push({type:"redacted-reasoning",data:$.data});break}break}case"tool-invocation":x.push({type:"tool-call",toolCallId:S.toolInvocation.toolCallId,toolName:S.toolInvocation.toolName,args:S.toolInvocation.args});break;default:{const $=S;throw new Error(`Unsupported part: ${$}`)}}o.push({role:"assistant",content:x});const V=I.filter(S=>S.type==="tool-invocation").map(S=>S.toolInvocation);V.length>0&&o.push({role:"tool",content:V.map(S=>{if(!("result"in S))throw new Ke({originalMessage:u,message:"ToolInvocation must have a result: "+JSON.stringify(S)});const{toolCallId:$,toolName:O,result:Y}=S,X=n[O];return X?.experimental_toToolResultContent!=null?{type:"tool-result",toolCallId:$,toolName:O,result:X.experimental_toToolResultContent(Y),experimental_content:X.experimental_toToolResultContent(Y)}:{type:"tool-result",toolCallId:$,toolName:O,result:Y}})}),I=[],E=!1,F++},F=0,E=!1,I=[];for(const x of u.parts)switch(x.type){case"text":{E&&N(),I.push(x);break}case"file":case"reasoning":{I.push(x);break}case"tool-invocation":{((a=x.toolInvocation.step)!=null?a:0)!==F&&N(),I.push(x),E=!0;break}}N();break}const b=u.toolInvocations;if(b==null||b.length===0){o.push({role:"assistant",content:c});break}const _=b.reduce((N,F)=>{var E;return Math.max(N,(E=F.step)!=null?E:0)},0);for(let N=0;N<=_;N++){const F=b.filter(E=>{var I;return((I=E.step)!=null?I:0)===N});F.length!==0&&(o.push({role:"assistant",content:[...i&&c&&N===0?[{type:"text",text:c}]:[],...F.map(({toolCallId:E,toolName:I,args:x})=>({type:"tool-call",toolCallId:E,toolName:I,args:x}))]}),o.push({role:"tool",content:F.map(E=>{if(!("result"in E))throw new Ke({originalMessage:u,message:"ToolInvocation must have a result: "+JSON.stringify(E)});const{toolCallId:I,toolName:x,result:V}=E,S=n[x];return S?.experimental_toToolResultContent!=null?{type:"tool-result",toolCallId:I,toolName:x,result:S.experimental_toToolResultContent(V),experimental_content:S.experimental_toToolResultContent(V)}:{type:"tool-result",toolCallId:I,toolName:x,result:V}})}))}c&&!i&&o.push({role:"assistant",content:c});break}case"data":break;default:{const b=l;throw new Ke({originalMessage:u,message:`Unsupported role: ${b}`})}}}return o}var ot=Ha(()=>R([Qa(),f(),ce(),G(),Ye(f(),ot),z(ot)])),T=Ye(f(),Ye(f(),ot)),ei=z(R([g({type:w("text"),text:f()}),g({type:w("image"),data:f(),mimeType:f().optional()})])),Ia=g({type:w("text"),text:f(),providerOptions:T.optional(),experimental_providerMetadata:T.optional()}),ti=g({type:w("image"),image:R([_a,Ae(URL)]),mimeType:f().optional(),providerOptions:T.optional(),experimental_providerMetadata:T.optional()}),Ea=g({type:w("file"),data:R([_a,Ae(URL)]),filename:f().optional(),mimeType:f(),providerOptions:T.optional(),experimental_providerMetadata:T.optional()}),ri=g({type:w("reasoning"),text:f(),providerOptions:T.optional(),experimental_providerMetadata:T.optional()}),ai=g({type:w("redacted-reasoning"),data:f(),providerOptions:T.optional(),experimental_providerMetadata:T.optional()}),ni=g({type:w("tool-call"),toolCallId:f(),toolName:f(),args:Ne(),providerOptions:T.optional(),experimental_providerMetadata:T.optional()}),oi=g({type:w("tool-result"),toolCallId:f(),toolName:f(),result:Ne(),content:ei.optional(),isError:G().optional(),providerOptions:T.optional(),experimental_providerMetadata:T.optional()}),si=g({role:w("system"),content:f(),providerOptions:T.optional(),experimental_providerMetadata:T.optional()}),ii=g({role:w("user"),content:R([f(),z(R([Ia,ti,Ea]))]),providerOptions:T.optional(),experimental_providerMetadata:T.optional()}),ui=g({role:w("assistant"),content:R([f(),z(R([Ia,Ea,ri,ai,ni]))]),providerOptions:T.optional(),experimental_providerMetadata:T.optional()}),li=g({role:w("tool"),content:z(oi),providerOptions:T.optional(),experimental_providerMetadata:T.optional()}),ci=R([si,ii,ui,li]);function pi({prompt:e,tools:t}){if(e.prompt==null&&e.messages==null)throw new J({prompt:e,message:"prompt or messages must be defined"});if(e.prompt!=null&&e.messages!=null)throw new J({prompt:e,message:"prompt and messages cannot be defined at the same time"});if(e.system!=null&&typeof e.system!="string")throw new J({prompt:e,message:"system must be a string"});if(e.prompt!=null){if(typeof e.prompt!="string")throw new J({prompt:e,message:"prompt must be a string"});return{type:"prompt",system:e.system,messages:[{role:"user",content:e.prompt}]}}if(e.messages!=null){const a=di(e.messages)==="ui-messages"?Qs(e.messages,{tools:t}):e.messages;if(a.length===0)throw new J({prompt:e,message:"messages must not be empty"});const n=Oe({value:a,schema:z(ci)});if(!n.success)throw new J({prompt:e,message:["message must be a CoreMessage or a UI message",`Validation error: ${n.error.message}`].join(`
`),cause:n.error});return{type:"messages",messages:a,system:e.system}}throw new Error("unreachable")}function di(e){if(!Array.isArray(e))throw new J({prompt:e,message:["messages must be an array of CoreMessage or UIMessage",`Received non-array value: ${JSON.stringify(e)}`].join(`
`),cause:e});if(e.length===0)return"messages";const t=e.map(fi);if(t.some(a=>a==="has-ui-specific-parts"))return"ui-messages";const r=t.findIndex(a=>a!=="has-core-specific-parts"&&a!=="message");if(r===-1)return"messages";throw new J({prompt:e,message:["messages must be an array of CoreMessage or UIMessage",`Received message of type: "${t[r]}" at index ${r}`,`messages[${r}]: ${JSON.stringify(e[r])}`].join(`
`),cause:e})}function fi(e){return typeof e=="object"&&e!==null&&(e.role==="function"||e.role==="data"||"toolInvocations"in e||"parts"in e||"experimental_attachments"in e)?"has-ui-specific-parts":typeof e=="object"&&e!==null&&"content"in e&&(Array.isArray(e.content)||"experimental_providerMetadata"in e||"providerOptions"in e)?"has-core-specific-parts":typeof e=="object"&&e!==null&&"role"in e&&"content"in e&&typeof e.content=="string"&&["system","user","assistant","tool"].includes(e.role)?"message":"other"}function mi({promptTokens:e,completionTokens:t}){return{promptTokens:e,completionTokens:t,totalTokens:e+t}}function gi(e,t){return{promptTokens:e.promptTokens+t.promptTokens,completionTokens:e.completionTokens+t.completionTokens,totalTokens:e.totalTokens+t.totalTokens}}var hi="JSON schema:",yi="You MUST answer with a JSON object that matches the JSON schema above.",vi="You MUST answer with JSON.";function _i({prompt:e,schema:t,schemaPrefix:r=t!=null?hi:void 0,schemaSuffix:a=t!=null?yi:vi}){return[e!=null&&e.length>0?e:void 0,e!=null&&e.length>0?"":void 0,r,t!=null?JSON.stringify(t):void 0,a].filter(n=>n!=null).join(`
`)}function bi(e){const t=e.map(r=>({...r,content:typeof r.content=="string"?r.content:r.content.map(Si)}));return JSON.stringify(t)}function Si(e){return e.type==="image"?{...e,image:e.image instanceof Uint8Array?mt(e.image):e.image}:e}W({prefix:"aiobj",size:24});W({prefix:"aiobj",size:24});var Ra="AI_NoOutputSpecifiedError",ka=`vercel.ai.error.${Ra}`,Ti=Symbol.for(ka),Pa,wi=class extends h{constructor({message:e="No output specified."}={}){super({name:Ra,message:e}),this[Pa]=!0}static isInstance(e){return h.hasMarker(e,ka)}};Pa=Ti;var Na="AI_ToolExecutionError",Oa=`vercel.ai.error.${Na}`,xi=Symbol.for(Oa),Ma,Ai=class extends h{constructor({toolArgs:e,toolName:t,toolCallId:r,cause:a,message:n=`Error executing tool ${t}: ${be(a)}`}){super({name:Na,message:n,cause:a}),this[Ma]=!0,this.toolArgs=e,this.toolName=t,this.toolCallId=r}static isInstance(e){return h.hasMarker(e,Oa)}};Ma=xi;function Ii(e){return e!=null&&Object.keys(e).length>0}function Ei({tools:e,toolChoice:t,activeTools:r}){return Ii(e)?{tools:(r!=null?Object.entries(e).filter(([n])=>r.includes(n)):Object.entries(e)).map(([n,o])=>{const s=o.type;switch(s){case void 0:case"function":return{type:"function",name:n,description:o.description,parameters:Ce(o.parameters).jsonSchema};case"provider-defined":return{type:"provider-defined",name:n,id:o.id,args:o.args};default:{const u=s;throw new Error(`Unsupported tool type: ${u}`)}}}),toolChoice:t==null?{type:"auto"}:typeof t=="string"?{type:t}:{type:"tool",toolName:t.toolName}}:{tools:void 0,toolChoice:void 0}}var Ri=/^([\s\S]*?)(\s+)(\S*)$/;function ki(e){const t=e.match(Ri);return t?{prefix:t[1],whitespace:t[2],suffix:t[3]}:void 0}function Pi(e){const t=ki(e);return t?t.prefix+t.whitespace:e}var Ca="AI_InvalidToolArgumentsError",$a=`vercel.ai.error.${Ca}`,Ni=Symbol.for($a),Da,ja=class extends h{constructor({toolArgs:e,toolName:t,cause:r,message:a=`Invalid arguments for tool ${t}: ${be(r)}`}){super({name:Ca,message:a,cause:r}),this[Da]=!0,this.toolArgs=e,this.toolName=t}static isInstance(e){return h.hasMarker(e,$a)}};Da=Ni;var Ua="AI_NoSuchToolError",Fa=`vercel.ai.error.${Ua}`,Oi=Symbol.for(Fa),La,st=class extends h{constructor({toolName:e,availableTools:t=void 0,message:r=`Model tried to call unavailable tool '${e}'. ${t===void 0?"No tools are available.":`Available tools: ${t.join(", ")}.`}`}){super({name:Ua,message:r}),this[La]=!0,this.toolName=e,this.availableTools=t}static isInstance(e){return h.hasMarker(e,Fa)}};La=Oi;var Za="AI_ToolCallRepairError",Va=`vercel.ai.error.${Za}`,Mi=Symbol.for(Va),Ba,Ci=class extends h{constructor({cause:e,originalError:t,message:r=`Error repairing tool call: ${be(e)}`}){super({name:Za,message:r,cause:e}),this[Ba]=!0,this.originalError=t}static isInstance(e){return h.hasMarker(e,Va)}};Ba=Mi;async function $i({toolCall:e,tools:t,repairToolCall:r,system:a,messages:n}){if(t==null)throw new st({toolName:e.toolName});try{return await nr({toolCall:e,tools:t})}catch(o){if(r==null||!(st.isInstance(o)||ja.isInstance(o)))throw o;let s=null;try{s=await r({toolCall:e,tools:t,parameterSchema:({toolName:u})=>Ce(t[u].parameters).jsonSchema,system:a,messages:n,error:o})}catch(u){throw new Ci({cause:u,originalError:o})}if(s==null)throw o;return await nr({toolCall:s,tools:t})}}async function nr({toolCall:e,tools:t}){const r=e.toolName,a=t[r];if(a==null)throw new st({toolName:e.toolName,availableTools:Object.keys(t)});const n=Ce(a.parameters),o=e.args.trim()===""?Oe({value:{},schema:n}):Rr({text:e.args,schema:n});if(o.success===!1)throw new ja({toolName:r,toolArgs:e.args,cause:o.error});return{type:"tool-call",toolCallId:e.toolCallId,toolName:r,args:o.value}}function or(e){const t=e.filter(r=>r.type==="text").map(r=>r.text).join("");return t.length>0?t:void 0}function Di({text:e="",files:t,reasoning:r,tools:a,toolCalls:n,toolResults:o,messageId:s,generateMessageId:u}){const i=[],l=[];return r.length>0&&l.push(...r.map(c=>c.type==="text"?{...c,type:"reasoning"}:{...c,type:"redacted-reasoning"})),t.length>0&&l.push(...t.map(c=>({type:"file",data:c.base64,mimeType:c.mimeType}))),e.length>0&&l.push({type:"text",text:e}),n.length>0&&l.push(...n),l.length>0&&i.push({role:"assistant",content:l,id:s}),o.length>0&&i.push({role:"tool",id:u(),content:o.map(c=>{const p=a[c.toolName];return p?.experimental_toToolResultContent!=null?{type:"tool-result",toolCallId:c.toolCallId,toolName:c.toolName,result:p.experimental_toToolResultContent(c.result),experimental_content:p.experimental_toToolResultContent(c.result)}:{type:"tool-result",toolCallId:c.toolCallId,toolName:c.toolName,result:c.result}})}),i}var ji=W({prefix:"aitxt",size:24}),Ui=W({prefix:"msg",size:24});async function vu({model:e,tools:t,toolChoice:r,system:a,prompt:n,messages:o,maxRetries:s,abortSignal:u,headers:i,maxSteps:l=1,experimental_generateMessageId:c=Ui,experimental_output:p,experimental_continueSteps:b=!1,experimental_telemetry:_,experimental_providerMetadata:N,providerOptions:F=N,experimental_activeTools:E,experimental_prepareStep:I,experimental_repairToolCall:x,_internal:{generateId:V=ji,currentDate:S=()=>new Date}={},onStepFinish:$,...O}){var Y;if(typeof e=="string"||e.specificationVersion!=="v1")throw new As;if(l<1)throw new U({parameter:"maxSteps",value:l,message:"maxSteps must be at least 1"});const{maxRetries:X,retry:Ga}=ks({maxRetries:s}),vt=Ps({model:e,telemetry:_,headers:i,settings:{...O,maxRetries:X}}),De=pi({prompt:{system:(Y=p?.injectIntoSystemPrompt({system:a,model:e}))!=null?Y:a,prompt:n,messages:o},tools:t}),je=Ms(_);return nt({name:"ai.generateText",attributes:ae({telemetry:_,attributes:{...at({operationId:"ai.generateText",telemetry:_}),...vt,"ai.model.provider":e.provider,"ai.model.id":e.modelId,"ai.prompt":{input:()=>JSON.stringify({system:a,prompt:n,messages:o})},"ai.settings.maxSteps":l}}),tracer:je,fn:async Ka=>{var _t,bt,St,Tt,wt,xt,At,It,Et,Rt,kt,Pt,Nt,Ot;const Wa=Xs(O);let m,B=[],oe=[],se=[],Ue=0;const H=[];let q="";const Mt=[],Fe=[];let Se={completionTokens:0,promptTokens:0,totalTokens:0},Q="initial";do{const Le=Ue===0?De.type:"messages",Ze=[...De.messages,...H],ee=await I?.({model:e,steps:Fe,maxSteps:l,stepNumber:Ue}),Ya=(_t=ee?.toolChoice)!=null?_t:r,Xa=(bt=ee?.experimental_activeTools)!=null?bt:E,Z=(St=ee?.model)!=null?St:e,Ct=await Gs({prompt:{type:Le,system:De.system,messages:Ze},modelSupportsImageUrls:Z.supportsImageUrls,modelSupportsUrl:(Tt=Z.supportsUrl)==null?void 0:Tt.bind(Z)}),Te={type:"regular",...Ei({tools:t,toolChoice:Ya,activeTools:Xa})};m=await Ga(()=>nt({name:"ai.generateText.doGenerate",attributes:ae({telemetry:_,attributes:{...at({operationId:"ai.generateText.doGenerate",telemetry:_}),...vt,"ai.model.provider":Z.provider,"ai.model.id":Z.modelId,"ai.prompt.format":{input:()=>Le},"ai.prompt.messages":{input:()=>bi(Ct)},"ai.prompt.tools":{input:()=>{var L;return(L=Te.tools)==null?void 0:L.map(we=>JSON.stringify(we))}},"ai.prompt.toolChoice":{input:()=>Te.toolChoice!=null?JSON.stringify(Te.toolChoice):void 0},"gen_ai.system":Z.provider,"gen_ai.request.model":Z.modelId,"gen_ai.request.frequency_penalty":O.frequencyPenalty,"gen_ai.request.max_tokens":O.maxTokens,"gen_ai.request.presence_penalty":O.presencePenalty,"gen_ai.request.stop_sequences":O.stopSequences,"gen_ai.request.temperature":O.temperature,"gen_ai.request.top_k":O.topK,"gen_ai.request.top_p":O.topP}}),tracer:je,fn:async L=>{var we,Ft,Lt,Zt,Vt,Bt;const M=await Z.doGenerate({mode:Te,...Wa,inputFormat:Le,responseFormat:p?.responseFormat({model:e}),prompt:Ct,providerMetadata:F,abortSignal:u,headers:i}),re={id:(Ft=(we=M.response)==null?void 0:we.id)!=null?Ft:V(),timestamp:(Zt=(Lt=M.response)==null?void 0:Lt.timestamp)!=null?Zt:S(),modelId:(Bt=(Vt=M.response)==null?void 0:Vt.modelId)!=null?Bt:Z.modelId};return L.setAttributes(ae({telemetry:_,attributes:{"ai.response.finishReason":M.finishReason,"ai.response.text":{output:()=>M.text},"ai.response.toolCalls":{output:()=>JSON.stringify(M.toolCalls)},"ai.response.id":re.id,"ai.response.model":re.modelId,"ai.response.timestamp":re.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(M.providerMetadata),"ai.usage.promptTokens":M.usage.promptTokens,"ai.usage.completionTokens":M.usage.completionTokens,"gen_ai.response.finish_reasons":[M.finishReason],"gen_ai.response.id":re.id,"gen_ai.response.model":re.modelId,"gen_ai.usage.input_tokens":M.usage.promptTokens,"gen_ai.usage.output_tokens":M.usage.completionTokens}})),{...M,response:re}}})),B=await Promise.all(((wt=m.toolCalls)!=null?wt:[]).map(L=>$i({toolCall:L,tools:t,repairToolCall:x,system:a,messages:Ze}))),oe=t==null?[]:await Fi({toolCalls:B,tools:t,tracer:je,telemetry:_,messages:Ze,abortSignal:u});const $t=mi(m.usage);Se=gi(Se,$t);let te="done";++Ue<l&&(b&&m.finishReason==="length"&&B.length===0?te="continue":B.length>0&&oe.length===B.length&&(te="tool-result"));const Dt=(xt=m.text)!=null?xt:"",jt=Q==="continue"&&q.trimEnd()!==q?Dt.trimStart():Dt,ie=te==="continue"?Pi(jt):jt;if(q=te==="continue"||Q==="continue"?q+ie:ie,se=sr(m.reasoning),Mt.push(...(At=m.sources)!=null?At:[]),Q==="continue"){const L=H[H.length-1];typeof L.content=="string"?L.content+=ie:L.content.push({text:ie,type:"text"})}else H.push(...Di({text:q,files:We(m.files),reasoning:sr(m.reasoning),tools:t??{},toolCalls:B,toolResults:oe,messageId:c(),generateMessageId:c}));const Ut={stepType:Q,text:ie,reasoning:or(se),reasoningDetails:se,files:We(m.files),sources:(It=m.sources)!=null?It:[],toolCalls:B,toolResults:oe,finishReason:m.finishReason,usage:$t,warnings:m.warnings,logprobs:m.logprobs,request:(Et=m.request)!=null?Et:{},response:{...m.response,headers:(Rt=m.rawResponse)==null?void 0:Rt.headers,body:(kt=m.rawResponse)==null?void 0:kt.body,messages:structuredClone(H)},providerMetadata:m.providerMetadata,experimental_providerMetadata:m.providerMetadata,isContinued:te==="continue"};Fe.push(Ut),await $?.(Ut),Q=te}while(Q!=="done");return Ka.setAttributes(ae({telemetry:_,attributes:{"ai.response.finishReason":m.finishReason,"ai.response.text":{output:()=>m.text},"ai.response.toolCalls":{output:()=>JSON.stringify(m.toolCalls)},"ai.usage.promptTokens":m.usage.promptTokens,"ai.usage.completionTokens":m.usage.completionTokens,"ai.response.providerMetadata":JSON.stringify(m.providerMetadata)}})),new Li({text:q,files:We(m.files),reasoning:or(se),reasoningDetails:se,sources:Mt,outputResolver:()=>{if(p==null)throw new wi;return p.parseOutput({text:q},{response:m.response,usage:Se,finishReason:m.finishReason})},toolCalls:B,toolResults:oe,finishReason:m.finishReason,usage:Se,warnings:m.warnings,request:(Pt=m.request)!=null?Pt:{},response:{...m.response,headers:(Nt=m.rawResponse)==null?void 0:Nt.headers,body:(Ot=m.rawResponse)==null?void 0:Ot.body,messages:H},logprobs:m.logprobs,steps:Fe,providerMetadata:m.providerMetadata})}})}async function Fi({toolCalls:e,tools:t,tracer:r,telemetry:a,messages:n,abortSignal:o}){return(await Promise.all(e.map(async({toolCallId:u,toolName:i,args:l})=>{const c=t[i];if(c?.execute==null)return;const p=await nt({name:"ai.toolCall",attributes:ae({telemetry:a,attributes:{...at({operationId:"ai.toolCall",telemetry:a}),"ai.toolCall.name":i,"ai.toolCall.id":u,"ai.toolCall.args":{output:()=>JSON.stringify(l)}}}),tracer:r,fn:async b=>{try{const _=await c.execute(l,{toolCallId:u,messages:n,abortSignal:o});try{b.setAttributes(ae({telemetry:a,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(_)}}}))}catch{}return _}catch(_){throw la(b,_),new Ai({toolCallId:u,toolName:i,toolArgs:l,cause:_})}}});return{type:"tool-result",toolCallId:u,toolName:i,args:l,result:p}}))).filter(u=>u!=null)}var Li=class{constructor(e){this.text=e.text,this.files=e.files,this.reasoning=e.reasoning,this.reasoningDetails=e.reasoningDetails,this.toolCalls=e.toolCalls,this.toolResults=e.toolResults,this.finishReason=e.finishReason,this.usage=e.usage,this.warnings=e.warnings,this.request=e.request,this.response=e.response,this.steps=e.steps,this.experimental_providerMetadata=e.providerMetadata,this.providerMetadata=e.providerMetadata,this.logprobs=e.logprobs,this.outputResolver=e.outputResolver,this.sources=e.sources}get experimental_output(){return this.outputResolver()}};function sr(e){return e==null?[]:typeof e=="string"?[{type:"text",text:e}]:e}function We(e){var t;return(t=e?.map(r=>new Cs(r)))!=null?t:[]}var Zi={};ft(Zi,{object:()=>Bi,text:()=>Vi});var Vi=()=>({type:"text",responseFormat:()=>({type:"text"}),injectIntoSystemPrompt({system:e}){return e},parsePartial({text:e}){return{partial:e}},parseOutput({text:e}){return e}}),Bi=({schema:e})=>{const t=Ce(e);return{type:"object",responseFormat:({model:r})=>({type:"json",schema:r.supportsStructuredOutputs?t.jsonSchema:void 0}),injectIntoSystemPrompt({system:r,model:a}){return a.supportsStructuredOutputs?r:_i({prompt:r,schema:t.jsonSchema})},parsePartial({text:r}){const a=To(r);switch(a.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:a.value};default:{const n=a.state;throw new Error(`Unsupported parse state: ${n}`)}}},parseOutput({text:r},a){const n=Rr({text:r});if(!n.success)throw new tr({message:"No object generated: could not parse the response.",cause:n.error,text:r,response:a.response,usage:a.usage,finishReason:a.finishReason});const o=Oe({value:n.value,schema:t});if(!o.success)throw new tr({message:"No object generated: response did not match schema.",cause:o.error,text:r,response:a.response,usage:a.usage,finishReason:a.finishReason});return o.value}}};function Ja(e,t){const r=e.getReader(),a=t.getReader();let n,o,s=!1,u=!1;async function i(c){try{n==null&&(n=r.read());const p=await n;n=void 0,p.done?c.close():c.enqueue(p.value)}catch(p){c.error(p)}}async function l(c){try{o==null&&(o=a.read());const p=await o;o=void 0,p.done?c.close():c.enqueue(p.value)}catch(p){c.error(p)}}return new ReadableStream({async pull(c){try{if(s){await l(c);return}if(u){await i(c);return}n==null&&(n=r.read()),o==null&&(o=a.read());const{result:p,reader:b}=await Promise.race([n.then(_=>({result:_,reader:r})),o.then(_=>({result:_,reader:a}))]);p.done||c.enqueue(p.value),b===r?(n=void 0,p.done&&(await l(c),s=!0)):(o=void 0,p.done&&(u=!0,await i(c)))}catch(p){c.error(p)}},cancel(){r.cancel(),a.cancel()}})}W({prefix:"aitxt",size:24});W({prefix:"msg",size:24});var Ji=g({name:f(),version:f()}).passthrough(),gt=g({_meta:A(g({}).passthrough())}).passthrough(),_e=gt,zi=g({method:f(),params:A(gt)}),qi=g({experimental:A(g({}).passthrough()),logging:A(g({}).passthrough()),prompts:A(g({listChanged:A(G())}).passthrough()),resources:A(g({subscribe:A(G()),listChanged:A(G())}).passthrough()),tools:A(g({listChanged:A(G())}).passthrough())}).passthrough();_e.extend({protocolVersion:f(),capabilities:qi,serverInfo:Ji,instructions:A(f())});var Gi=_e.extend({nextCursor:A(f())}),Ki=g({name:f(),description:A(f()),inputSchema:g({type:w("object"),properties:A(g({}).passthrough())}).passthrough()}).passthrough();Gi.extend({tools:z(Ki)});var Wi=g({type:w("text"),text:f()}).passthrough(),Yi=g({type:w("image"),data:f().base64(),mimeType:f()}).passthrough(),za=g({uri:f(),mimeType:A(f())}).passthrough(),Xi=za.extend({text:f()}),Hi=za.extend({blob:f().base64()}),Qi=g({type:w("resource"),resource:R([Xi,Hi])}).passthrough();_e.extend({content:z(R([Wi,Yi,Qi])),isError:G().default(!1).optional()}).or(_e.extend({toolResult:Ne()}));var $e="2.0",eu=g({jsonrpc:w($e),id:R([f(),ce().int()])}).merge(zi).strict(),tu=g({jsonrpc:w($e),id:R([f(),ce().int()]),result:_e}).strict(),ru=g({jsonrpc:w($e),id:R([f(),ce().int()]),error:g({code:ce().int(),message:f(),data:A(Ne())})}).strict(),au=g({jsonrpc:w($e)}).merge(g({method:f(),params:A(gt)})).strict();R([eu,au,tu,ru]);var nu={};ft(nu,{mergeIntoDataStream:()=>iu,toDataStream:()=>ou,toDataStreamResponse:()=>su});function qa(e={}){const t=new TextEncoder;let r="";return new TransformStream({async start(){e.onStart&&await e.onStart()},async transform(a,n){n.enqueue(t.encode(a)),r+=a,e.onToken&&await e.onToken(a),e.onText&&typeof a=="string"&&await e.onText(a)},async flush(){e.onCompletion&&await e.onCompletion(r),e.onFinal&&await e.onFinal(r)}})}function ht(e,t){return e.pipeThrough(new TransformStream({transform:async(r,a)=>{var n;if(typeof r=="string"){a.enqueue(r);return}if("event"in r){r.event==="on_chat_model_stream"&&ir((n=r.data)==null?void 0:n.chunk,a);return}ir(r,a)}})).pipeThrough(qa(t)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(r,a)=>{a.enqueue(Kr("text",r))}}))}function ou(e,t){return ht(e,t).pipeThrough(new TextEncoderStream)}function su(e,t){var r;const a=ht(e,t?.callbacks).pipeThrough(new TextEncoderStream),n=t?.data,o=t?.init,s=n?Ja(n.stream,a):a;return new Response(s,{status:(r=o?.status)!=null?r:200,statusText:o?.statusText,headers:ta(o?.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function iu(e,t){t.dataStream.merge(ht(e,t.callbacks))}function ir(e,t){if(typeof e.content=="string")t.enqueue(e.content);else{const r=e.content;for(const a of r)a.type==="text"&&t.enqueue(a.text)}}var uu={};ft(uu,{mergeIntoDataStream:()=>pu,toDataStream:()=>lu,toDataStreamResponse:()=>cu});function yt(e,t){const r=du();return dn(e[Symbol.asyncIterator]()).pipeThrough(new TransformStream({async transform(a,n){n.enqueue(r(a.delta))}})).pipeThrough(qa(t)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(a,n)=>{n.enqueue(Kr("text",a))}}))}function lu(e,t){return yt(e,t).pipeThrough(new TextEncoderStream)}function cu(e,t={}){var r;const{init:a,data:n,callbacks:o}=t,s=yt(e,o).pipeThrough(new TextEncoderStream),u=n?Ja(n.stream,s):s;return new Response(u,{status:(r=a?.status)!=null?r:200,statusText:a?.statusText,headers:ta(a?.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function pu(e,t){t.dataStream.merge(yt(e,t.callbacks))}function du(){let e=!0;return t=>(e&&(t=t.trimStart(),t&&(e=!1)),t)}export{h as AISDKError,nn as APICallError,Ge as DownloadError,U as InvalidArgumentError,rr as InvalidDataContentError,zs as InvalidMessageRoleError,J as InvalidPromptError,ja as InvalidToolArgumentsError,Jt as JSONParseError,nu as LangChainAdapter,uu as LlamaIndexAdapter,Ke as MessageConversionError,tr as NoObjectGeneratedError,wi as NoOutputSpecifiedError,st as NoSuchToolError,Zi as Output,er as RetryError,Ci as ToolCallRepairError,Ai as ToolExecutionError,zt as TypeValidationError,As as UnsupportedModelVersionError,Qs as convertToCoreMessages,ui as coreAssistantMessageSchema,ci as coreMessageSchema,si as coreSystemMessageSchema,li as coreToolMessageSchema,ii as coreUserMessageSchema,W as createIdGenerator,Kr as formatDataStreamPart,vu as generateText,Lo as jsonSchema,Fo as zodSchema};
